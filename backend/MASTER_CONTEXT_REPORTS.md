# MASTER_CONTEXT_REPORTS.md

*reports, evidence, accountability*

---

## 1. Назначение Reports в CleanProof

Reports в CleanProof — это **управленческий и доказательный слой**, а не аналитика.

Он отвечает на вопрос:

> **“Что можно показать owner’у или внешнему стейкхолдеру как подтверждённый факт?”**

Reports:

* не исследуют данные;
* не ищут тренды;
* не предполагают действий.

Они **фиксируют состояние** и **поддерживают ответственность**.

---

## 2. Reports ≠ Analytics ≠ Job History

Это три разные сущности.

### Reports

* narrative summary;
* агрегаты без динамики;
* ориентированы на owner’а и аудит;
* допускают email-доставку.

### Analytics

* интерактивные метрики;
* тренды;
* рабочий инструмент менеджера.

### Job History

* полный архив;
* фильтрация и аудит;
* источник конкретных фактов.

Любое смешение — архитектурная ошибка.

---

## 3. Reports — read-only слой

Reports:

* **не меняют данные**;
* **не создают execution-события**;
* **не вмешиваются в SLA**.

Они:

* читают данные из backend;
* используют те же источники, что и UI;
* не содержат собственной логики.

---

## 4. Источник истины для Reports

Reports используют **тот же SLA-движок**, что и Analytics:

```
compute_sla_status_and_reasons_for_job(job)
```

Правило:

> **Если цифры в Report и Analytics отличаются — Report ошибочен.**

---

## 5. Типы Reports (v1)

### 1. Job Report (PDF)

* один job;
* факты выполнения;
* proof (photos, checklist);
* SLA status + reasons;
* audit trail.

Используется для:

* клиентов;
* разборов;
* доказательств выполнения.

---

### 2. Weekly Report

* rolling 7 days;
* jobs completed;
* violations count;
* issue rate;
* top cleaners;
* top locations;
* top SLA reasons.

---

### 3. Monthly Report

* rolling 30 days;
* те же агрегаты, что и weekly;
* без сравнений с прошлым периодом.

---

## 6. Owner vs Manager — разделение ответственности

### Owner Reports

Owner должен:

* понять состояние бизнеса за 1 экран;
* увидеть, есть ли проблемы;
* не вникать в детали.

Принципы:

* один период;
* один вывод;
* минимум деталей.

---

### Manager Reports

Manager:

* видит те же агрегаты;
* дополнительно видит причины;
* может перейти к списку проблемных jobs.

Manager Report — **объяснение**, не управление.

---

## 7. Reports не содержат трендов

Принципиально:

* нет графиков по времени;
* нет WoW / MoM;
* нет сравнений периодов.

Если нужен тренд → Analytics.

---

## 8. Email как часть Reports

Email — это **канал доставки**, а не фича.

Правила:

* UI, PDF и Email используют **один источник данных**;
* отправка email фиксируется как событие;
* история email — часть audit trail.

---

## 9. Email Audit Trail

Для каждого отправленного отчёта фиксируется:

* тип отчёта;
* период или job;
* получатель;
* статус доставки;
* время отправки;
* инициатор.

Email history:

* менеджерский инструмент;
* не технический лог;
* используется для доказательства факта отправки.

---

## 10. Drill-down из Reports

Допустимый drill-down:

```
Report aggregate
→ SLA reason
→ list of jobs
→ Job Details
```

Недопустимый:

* редактирование;
* исправление;
* повторный расчёт.

---

## 11. Reports и PDF — один источник

PDF:

* не “другая версия”;
* не кеш;
* не рендер UI.

PDF — **визуальное представление backend-данных**.

Если PDF и UI расходятся — ошибка backend.

---

## 12. Что запрещено в Reports

Запрещено:

* добавлять фильтры “на лету”;
* делать интерактивные графики;
* менять периоды произвольно;
* добавлять бизнес-логику;
* “лечить” SLA в отчётах.

Reports — зеркало, не инструмент управления.

---

## 13. Reports как доказательная цепочка

Reports замыкают цепочку:

```
Execution
→ SLA
→ Analytics
→ Reports
→ PDF
→ Email
→ Audit Trail
```

Ни одно звено не может пропускаться или подменяться.

---

## 14. Статус Reports слоя

**Reports v1/v2 — реализованы и зафиксированы.**

Слой:

* стабилен;
* готов к биллингу;
* пригоден для аудита и внешних демонстраций.

---

### Статус файла

**Зафиксирован. Source of truth для Reports.**

---

